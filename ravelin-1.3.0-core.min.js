/*! ravelinjs 1.3.0 - https://github.com/unravelin/ravelinjs. Copyright 2021 */
var Ravelin=function(){"use strict";var t;function e(t){this.domain=t.domain}function n(t,e,n){return n=Array.prototype.slice.call(arguments,2),Function.prototype.bind?Function.prototype.bind.apply(t,[e].concat(n)):function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}function i(){var e,n,i,r;if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues&&"undefined"!=typeof Int32Array){var o=new Int32Array(4);window.crypto.getRandomValues(o),e=o[0],n=o[1],i=o[2],r=o[3]}else e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;if(!t){t=[];for(var s=0;s<256;s++)t[s]=(s<16?"0":"")+s.toString(16)}return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&i|128]+t[i>>8&255]+"-"+t[i>>16&255]+t[i>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function r(t){this.Promise=t.Promise,this.key=t.key,this.api=t.api||function(t){if(!t||"publishable_key_"!=t.substr(0,16))return o;var e=t.substr(16).split("_");if(e.length<2)return o;var n=e[e.length-2];if("test"==n||"live"==n)return o;return"https://"+encodeURIComponent(n)+".ravelin.click"}(this.key),this.api=this.api[0]+this.api.substr(1).replace(/^\/+|\/$/g,""),this.sendRetryMs=t.sendRetryMs||150,this.cookie=t.cookie||"ravelinDeviceId",this.sessionCookie=t.sessionCookie||"ravelinSessionId",this.cookieExpiryDays=t.cookieExpiryDays||365,this.cookies=new e({domain:t.cookieDomain}),this._id=function(t,e){if(e&&"function"==typeof e.then)return e;return new t((function(t){t(e)}))}(this.Promise,t.id),this.sync(),!1!==t.init&&this.attach(t.syncMs||2e3)}e.prototype.get=function(t){for(var e=document.cookie.split("; "),n=e.length-1;n>=0;n--){var i=e[n].split("=");if(i[0]===t)return i[1]}return undefined},e.prototype.set=function(t){var e=t.name+"="+t.value+";path="+(t.path||"/")+(t.expires?";expires="+t.expires.toUTCString():"")+(this.domain?";domain="+this.domain:"");if("undefined"==typeof this.samesite){if(!function(t){if(/\(iP.+; CPU .*OS 12[_\d]*.*\) AppleWebKit\//.test(t))return!0;if(/\(Macintosh;.*Mac OS X 10_14[_\d]*.*\) AppleWebKit\//.test(t)){if(/^Mozilla\/[\.\d]+ \(Macintosh;.*Mac OS X [_\d]+\) AppleWebKit\/[\.\d]+ \(KHTML, like Gecko\)$/.test(t))return!0;if(/Version\/.* Safari\//.test(t)&&!/Chrom(e|ium)/.test(t))return!0}return!1}(window.navigator.userAgent)?"https:"==window.location.protocol?this.samesite=";SameSite=None;Secure":this.samesite=";SameSite=Lax":this.samesite="",document.cookie=e+this.samesite,this.get(t.name)==t.value)return;this.samesite=""}document.cookie=e+this.samesite},r.prototype.id=function(){return this.ids().then((function(t){return t.device}))},r.prototype.ids=function(){if(this._ids)return this._ids;var t=this;return this._ids=this.sniffError(this._id).then(undefined,(function(){})).then((function(e){var n=e||t.cookies.get(t.cookie),r=t.cookies.get(t.sessionCookie);if(!e&&r){var o=r.indexOf(":");-1!=o&&(n=r.substr(0,o)),n&&function(t,e){return t.substr(0,e.length)===e}(r,n+":")&&(r=r.substr(n.length+1))}return{device:n||"rjs-"+i(),session:r||i()}})),this._ids},r.prototype.sync=function(){var t=this;return this.ids().then((function(e){var n;t.cookieExpiryDays>0&&t.cookies.set({name:t.cookie,value:e.device,expires:(n=t.cookieExpiryDays,new Date((new Date).getTime()+86400*n*1e3))}),t.cookies.set({name:t.sessionCookie,value:e.device+":"+e.session})}))},r.prototype.attach=function(t){setInterval(n(this.sync,this),t)};var o="https://live.ravelin.click";var s=window.XDomainRequest;function a(t){if(Array.prototype.toJSON){var e=Array.prototype.toJSON;delete Array.prototype.toJSON;var n=JSON.stringify(t);return Array.prototype.toJSON=e,n}return JSON.stringify(t)}function u(t){t.Promise=t.Promise||u.Promise,this.core=new r(t)}return r.prototype.reportError=function(t){var e=this;return this._ids?this._ids.then(undefined,(function(){})).then(n):n();function n(n){return e.send("POST","z/err",{deviceId:n&&n.device,libVer:"1.3.0-ravelinjs",type:t.name,msg:t.message||t,error:t.stack}).then((function(){}))}},r.prototype.sniffError=function(t){var e=this;try{var n="function"==typeof t?t():t;return n&&n.then&&n.then(undefined,(function(t){e.reportError(t)})),n}catch(i){throw e.reportError(i),i}},r.prototype.bind=function(){var t=this,e=n.apply(null,Array.prototype.slice.call(arguments));return function(){var n=Array.prototype.slice.call(arguments);return t.sniffError((function(){return e.apply(null,n)}))}},r.prototype.send=function(t,e,n){if(!this.key)throw new Error("ravelin/core: no key set for API requests");var i=this.api+"/"+e.replace(/^\/+/,"");i=(i+=(-1==i.indexOf("?")?"?":"&")+"key="+encodeURIComponent(this.key)).replace(/^\/+/,"/");var r=this;return function(t,e,n,i){n||(n=2);var r=0;return new t((function(o,s){return function a(u){return new t((function(t){u?setTimeout(t,u):t()})).then((function(){return e((function(t){throw{message:"promise-retry",err:t}}),++r)})).then(o,(function(t){if(t&&"promise-retry"===t.message)return r-1<n?a(u+(i||150)):void s(t.err);s(t)}))}(0)}))}(r.Promise,(function(e,o){return!function(t){var e=t.match("(https?)?://([^/]+)");return!e||e[2]==window.location.host&&(""==e[1]||e[1]==window.location.protocol.replace(/:/,""))}(i)&&s?r._sendXDR(t,i,a(n)):r._sendXHR(t,i,a(n)).then((function(t){return t.attempt=o,1223==t.status&&(t.status=204),t.status>=200&&t.status<300?t:(400==t.status&&""==t.text||t.status>=500?e(t):t.status||e(t),new r.Promise((function(e,n){n(t)})))}))}),2,this.sendRetryMs).then(undefined,(function(e){if(e.attempt)throw new Error("ravelin/core: "+t+" "+i+" attempt "+e.attempt+" returned status "+e.status+(e.text?" and body "+e.text:""));throw e}))},r.prototype._sendXHR=function(t,e,n){return new this.Promise((function(i){var r=new XMLHttpRequest;r.onreadystatechange=function(){4==r.readyState&&i({status:r.status,text:r.responseText})},r.open(t,e),r.send(n)}))},r.prototype._sendXDR=function(t,e,n){return new this.Promise((function(i,r){var o=new s;o.onload=function(){i({status:o.status||200,text:o.responseText})},o.onerror=function(){r({status:o.status,text:o.responseText})},o.onprogress=function(){},o.open(t,e),setTimeout((function(){o.send(n)}),0)}))},u.Promise=window.Promise,u}();
//# sourceMappingURL=ravelin-core.min.js.map
